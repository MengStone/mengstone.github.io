<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>宝箱的网站</title>
<style>
  /* --- 变量定义 --- */
  :root {
    --bg-color: #f6f6f7;
    --card-bg: rgba(255, 255, 255, 0.7);
    --text-main: #1d1d1f;
    --text-secondary: #86868b;
    --accent: #0071e3;
    --glass-blur: 16px;
    --border-radius: 24px;
    --transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
  }

  /* --- 全局样式 --- */
  html {
    scrollbar-gutter: stable;
    overflow-y: scroll;
  }

  body {
    margin: 0;
    font-family: -apple-system, "SF Pro Display", "PingFang SC", "Helvetica Neue", sans-serif;
    background-color: var(--bg-color);
    color: var(--text-main);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    /* 微弱渐变背景提升质感 */
    background: radial-gradient(circle at 0% 0%, #ffffff 0%, #f6f6f7 100%);
    background-attachment: fixed;
  }

  .container {
    max-width: 1100px;
    margin: 80px auto;
    padding: 0 40px;
  }

  header {
    margin-bottom: 60px;
    animation: fadeIn 1s ease;
  }

  header h1 {
    font-family: "Georgia", "Times New Roman", serif;
    font-size: 3.5rem;
    font-weight: 700;
    margin: 0;
    letter-spacing: -0.02em;
  }

  header p {
    font-size: 1.1rem;
    color: var(--text-secondary);
    margin-top: 10px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
  }

  /* --- Bento Grid 栅格系统 --- */
  #home-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    grid-auto-rows: 180px;
    gap: 24px;
    animation: fadeInUp 0.8s ease;
  }

  .module-card {
    background-color: var(--card-bg);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: var(--border-radius);
    padding: 32px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }

  .module-card:hover {
    transform: translateY(-8px) scale(1.02);
    background-color: rgba(255, 255, 255, 0.9);
    box-shadow: 0 30px 60px rgba(0,0,0,0.08);
  }

  /* 卡片跨度设置 */
  .module-card[data-module="world"] { grid-column: span 4; grid-row: span 2; }
  .module-card[data-module="log"] { grid-column: span 2; grid-row: span 1; }
  .module-card[data-module="contact"] { grid-column: span 2; grid-row: span 1; }
  .module-card[data-module="essay"] { grid-column: span 3; grid-row: span 1; }
  .module-card[data-module="project"] { grid-column: span 3; grid-row: span 1; }

  .module-card[data-module="world"] {
    background-image: url("images/世界观栏目背景图.png");
    background-size: cover;
    background-position: center;
  }

  .module-card[data-module="world"]::before {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(246, 246, 247, 0.18);
    pointer-events: none;
  }

  .module-card[data-module="world"] > * {
    position: relative;
    z-index: 1;
  }

  .module-card img {
    width: 56px;
    height: 56px;
    object-fit: contain;
    filter: grayscale(1);
    opacity: 0.7;
    transition: var(--transition);
  }

  .module-card:hover img {
    filter: grayscale(0);
    opacity: 1;
    transform: scale(1.1);
  }

  .module-card-title {
    font-size: 1.4rem;
    font-weight: 600;
    letter-spacing: -0.01em;
  }

  .module-card[data-module="world"] .module-card-title {
    display: inline-block;
    width: fit-content;
    padding: 8px 14px;
    border-radius: 999px;
    color: rgba(29, 29, 31, 0.95);
    background: rgba(255, 255, 255, 0.22);
    border: 1px solid rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    text-shadow:
      0 10px 30px rgba(0, 0, 0, 0.18),
      0 2px 6px rgba(0, 0, 0, 0.14),
      0 1px 0 rgba(255, 255, 255, 0.35);
  }

  /* --- 模块详细视图 --- */
  .module-view {
    display: none;
    opacity: 0;
    transform: translateY(30px);
    transition: var(--transition);
  }

  .module-view.active {
    display: block;
    opacity: 1;
    transform: translateY(0);
  }

  .back-button {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 40px;
    padding: 12px 24px;
    background: var(--card-bg);
    border-radius: 100px;
    cursor: pointer;
    font-weight: 600;
    border: 1px solid rgba(0,0,0,0.05);
    transition: var(--transition);
  }

  .back-button:hover {
    background: #fff;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
  }

  .back-button img { width: 18px; height: 18px; }

  .module-title {
    font-family: "Georgia", serif;
    font-size: 2.5rem;
    margin-bottom: 30px;
  }

  /* --- 内容组件样式 --- */
  .post {
    background: white;
    padding: 40px;
    border-radius: var(--border-radius);
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.02);
  }

  #module-log {
    font-size: 20px;
  }

  .month-header {
    margin: 80px 0 40px;
  }

  .month-header h2 {
    font-family: "Georgia", serif;
    font-size: 4rem;
    color: var(--text-main);
    opacity: 0.1;
    margin: 0;
  }

  footer {
    margin-top: 100px;
    padding-bottom: 40px;
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.9rem;
  }

  footer a { color: var(--text-main); text-decoration: none; font-weight: 600; }

  /* --- 动画 --- */
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes fadeIn {
    from { opacity: 0; } to { opacity: 1; }
  }

  /* --- 手机端兼容 --- */
  @media (max-width: 768px) {
    .container { padding: 0 20px; margin: 40px auto; }
    header h1 { font-size: 2.5rem; }
    #home-grid { grid-template-columns: 1fr; grid-auto-rows: auto; }
    .module-card[data-module] { grid-column: span 1; grid-row: span 1; height: 160px; }
  }
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>宝箱的网站</h1>
    <p>GAMES, WORLD & LOGS</p>
  </header>

  <section id="home-grid">
    <div class="module-card" data-module="world">
      <img src="icons/Icon_奇幻世界观.png" alt="世界观">
      <div class="module-card-title">世界观设定集</div>
    </div>
    <div class="module-card" data-module="log">
      <img src="icons/Icon_工作日志.png" alt="日志">
      <div class="module-card-title">工作日志</div>
    </div>
    <div class="module-card" data-module="contact">
      <img src="icons/Icon_联系方式.png" alt="联系">
      <div class="module-card-title">联系方式</div>
    </div>
    <div class="module-card" data-module="essay">
      <img src="icons/Icon_随笔.png" alt="随笔">
      <div class="module-card-title">随笔</div>
    </div>
    <div class="module-card" data-module="project">
      <img src="icons/Icon_游戏项目.png" alt="项目">
      <div class="module-card-title">游戏项目</div>
    </div>
  </section>

  <section id="module-view" class="module-view">
    <div id="back-button" class="back-button">
      <img src="icons/Icon_返回.png" alt="Back">
      <span>返回主页</span>
    </div>

    <h2 id="module-title" class="module-title"></h2>

    <div id="module-world" class="module-section" style="display:none;">
      <div class="post">暂无内容</div>
    </div>

    <div id="module-log" class="module-section" style="display:none;">
      <section class="posts" id="posts-container">
        <p>正在加载日志...</p>
      </section>
    </div>

    <div id="module-contact" class="module-section" style="display:none;"></div>
    <div id="module-essay" class="module-section" style="display:none;">
      <div class="post">暂无内容</div>
    </div>
    <div id="module-project" class="module-section" style="display:none;"></div>
  </section>

  <footer>
    &copy; 2025 MengStone · <a href="https://github.com/MengStone" target="_blank">GITHUB</a>
  </footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // 逻辑部分保留你的 Markdown 解析核心，仅在最后添加视图切换逻辑
    const homeGrid = document.getElementById('home-grid');
    const moduleView = document.getElementById('module-view');
    const backButton = document.getElementById('back-button');
    const moduleTitleEl = document.getElementById('module-title');
    const moduleSections = {
      world: document.getElementById('module-world'),
      log: document.getElementById('module-log'),
      contact: document.getElementById('module-contact'),
      essay: document.getElementById('module-essay'),
      project: document.getElementById('module-project')
    };
    const postsContainer = document.getElementById('posts-container');

    // --- 保持你的 parseMarkdown, loadMonthlyPost, loadAllPosts 函数逻辑不变 ---
    // (此处省略你的 parseMarkdown 等具体实现，请确保将原有的 JS 代码合并到这里)
    // [插入你原来的 parseMarkdown, loadMonthlyPost, loadAllPosts, loadSingleMarkdown 函数]

    // --- 视图控制 ---
    const showHome = () => {
      moduleView.classList.remove('active');
      setTimeout(() => {
        moduleView.style.display = 'none';
        homeGrid.style.display = 'grid';
      }, 300);
    };

    const showModule = async (key) => {
      homeGrid.style.display = 'none';
      moduleView.style.display = 'block';
      setTimeout(() => moduleView.classList.add('active'), 10);

      // 设置标题
      const titles = { world:'游戏世界观', log:'工作日志', contact:'联系方式', essay:'随笔', project:'游戏项目' };
      moduleTitleEl.textContent = titles[key];

      // 隐藏所有节
      Object.values(moduleSections).forEach(s => s.style.display = 'none');
      moduleSections[key].style.display = 'block';

      // 异步加载内容
      if (key === 'log' && postsContainer.innerHTML.includes('正在加载')) await loadAllPosts();
      if (key === 'contact') await loadSingleMarkdown('posts/联系方式.md', moduleSections.contact);
      if (key === 'project') await loadSingleMarkdown('posts/游戏项目.md', moduleSections.project);
    };

    document.querySelectorAll('.module-card').forEach(card => {
      card.addEventListener('click', () => showModule(card.dataset.module));
    });
    backButton.addEventListener('click', showHome);

    // --- 引用你原始代码中复杂的 Markdown 解析函数 (必须复制过来以保证功能正常) ---
    function parseMarkdown(md) {
      if (!md) return '';
      const esc = (s) => s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
      const lines = md.replace(/\r\n?/g, '\n').split('\n');
      const html = [];
      let inUl = false;
      let para = [];
      const flushPara = () => { if (para.length) { html.push(`<p>${inline(para.join('<br>'))}</p>`); para = []; } };
      const closeUl = () => { if (inUl) { html.push('</ul>'); inUl = false; } };
      const inline = (s) => {
        s = esc(s).replace(/&lt;br&gt;/g, '<br>');
        s = s.replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank">$1</a>');
        s = s.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
        s = s.replace(/`([^`]+)`/g, '<code>$1</code>');
        return s;
      };
      for (let line of lines) {
        if (/^\s*$/.test(line)) { closeUl(); flushPara(); continue; }
        const img = line.match(/^!\[(.*?)\]\((.+?)\)/);
        if (img) { closeUl(); flushPara(); html.push(`<p><img src="${img[2]}" alt="${esc(img[1])}" style="max-width:100%;border-radius:12px;" /></p>`); continue; }
        const h = line.match(/^(#{1,3})\s+(.+)/);
        if (h) { closeUl(); flushPara(); const tag = `h${h[1].length}`; html.push(`<${tag}>${inline(h[2])}</${tag}>`); continue; }
        const li = line.match(/^[-*]\s+(.+)/);
        if (li) { flushPara(); if (!inUl) { html.push('<ul>'); inUl = true; } html.push(`<li>${inline(li[1])}</li>`); continue; }
        para.push(line.trim());
      }
      closeUl(); flushPara();
      return html.join('\n');
    }

    async function loadMonthlyPost(postData) {
      try {
        const response = await fetch(postData.file);
        const markdownText = await response.text();
        const monthStr = postData.month || '';
        const headingRegex = /(\n|^)##\s+(\d{4}-\d{2}-\d{2}|\d{2}-\d{2})([^\n]*)\s*\n/g;
        let match, indices = [];
        while ((match = headingRegex.exec(markdownText)) !== null) {
          indices.push({ headingStart: match.index + (match[1]?match[1].length:0), contentStart: headingRegex.lastIndex, dateText: match[2], extraTitle: (match[3]||'').trim() });
        }
        if (!indices.length) {
          const postDiv = document.createElement('div'); postDiv.className = 'post';
          postDiv.innerHTML = (postData.title ? `<h2>${postData.title}</h2>` : '') + parseMarkdown(markdownText);
          postsContainer.appendChild(postDiv); return { lastCard: postDiv };
        }
        let sections = [];
        for (let i = 0; i < indices.length; i++) {
          const start = indices[i].contentStart, end = i + 1 < indices.length ? indices[i + 1].headingStart : markdownText.length;
          sections.push({ ...indices[i], content: markdownText.slice(start, end) });
        }
        sections.sort((a,b) => b.dateText.localeCompare(a.dateText));
        let lastCard = null;
        sections.forEach(sec => {
          if (sec.content.trim() === '-') return;
          const postDiv = document.createElement('div'); postDiv.className = 'post';
          postDiv.innerHTML = `<h3>${sec.extraTitle || sec.dateText}</h3><div style="color:#86868b;font-size:0.9rem;margin-bottom:15px;">Date: ${sec.dateText}</div>` + parseMarkdown(sec.content);
          postsContainer.appendChild(postDiv); lastCard = postDiv;
        });
        return { lastCard };
      } catch (e) { console.error(e); }
    }

    async function loadAllPosts() {
      try {
        const response = await fetch('posts.json');
        const postList = await response.json();
        if (!postList.length) { postsContainer.innerHTML = '<p>暂无日志。</p>'; return; }
        postsContainer.innerHTML = '';
        const months = postList.filter(x => x.month).sort((a,b) => b.month.localeCompare(a.month));
        for (let m of months) { await loadMonthlyPost(m); }
      } catch (e) { postsContainer.innerHTML = '加载失败'; }
    }

    async function loadSingleMarkdown(url, container) {
      try {
        const resp = await fetch(url);
        const text = await resp.text();
        container.innerHTML = `<div class="post">${parseMarkdown(text)}</div>`;
      } catch (e) { container.innerHTML = '加载失败'; }
    }
});
</script>

</body>
</html>