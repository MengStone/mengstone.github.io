<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>宝箱的个人网站</title>
<style>
  /* 全局样式 */
  body {
    margin: 0;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    background-color: #f5f5f5;
    color: #222;
    line-height: 1.6;
  }

  a {
    color: #3a7afe;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  /* 容器 */
  .container {
    max-width: 900px;
    margin: 40px auto;
    padding: 0 20px;
  }

  /* 顶部标题 */
  header {
    text-align: center;
    margin-bottom: 40px;
  }

  header h1 {
    font-size: 2.8em;
    margin: 0;
  }

  header p {
    font-size: 1.2em;
    color: #555;
  }

  /* 文章列表 */
  .post {
    background-color: #fff;
    padding: 20px 25px;
    margin-bottom: 25px;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.05);
    transition: transform 0.2s;
  }

  .post:hover {
    transform: translateY(-3px);
  }
  /* 确保 Markdown 转换后的元素样式正确 */
  .post h1, .post h2, .post h3 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.6em; /* 使用 Markdown 中的 H1/H2 作为文章标题 */
  }

  .post p, .post ul, .post ol {
    margin: 0 0 1em 0;
  }
  
  /* 添加日期/元信息样式 */
  .post-meta {
    color: #777;
    font-size: 0.9em;
    margin-bottom: 10px;
    border-bottom: 1px solid #eee;
    padding-bottom: 5px;
  }
</style>
</head>
<body>
<div class="container">

  <header>
    <h1>拉比的村子</h1>
    <p>游戏开发日志</p>
  </header>

  <section class="posts" id="posts-container">
    <p>正在加载日志...</p>
  </section>

  <footer>
    &copy; 2025 MengStone · <a href="https://github.com/MengStone">GitHub</a>
  </footer>

</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const postsContainer = document.getElementById('posts-container');
    postsContainer.innerHTML = ''; // 清空“正在加载”提示

    // 1. 异步加载并渲染单个 Markdown 文件
    async function loadPost(postData) {
        try {
            const response = await fetch(postData.file);
            if (!response.ok) {
                throw new Error(`无法加载文件: ${postData.file}`);
            }
            const markdownText = await response.text();
            const htmlContent = marked.parse(markdownText);

            // 创建文章容器
            const postDiv = document.createElement('div');
            postDiv.className = 'post';
            
            // 添加元信息（日期和标题）
            let metaHtml = '';
            if (postData.title) {
                // 如果 Markdown 文件内部也有标题，这里可以只显示日期
                // 为了避免重复，我们只显示日期，但保持标题的标记在 JSON 中
                metaHtml += `<h2>${postData.title}</h2>`; 
            }
            if (postData.date) {
                metaHtml += `<div class="post-meta">发布于: ${postData.date}</div>`;
            }

            // 将元信息和转换后的 HTML 放入容器
            postDiv.innerHTML = metaHtml + htmlContent;
            
            // 插入到日志容器中
            postsContainer.appendChild(postDiv);

        } catch (error) {
            console.error(error);
            const errorDiv = document.createElement('div');
            errorDiv.className = 'post';
            errorDiv.innerHTML = `<p style="color:red;">加载文章失败: ${postData.file}</p>`;
            postsContainer.appendChild(errorDiv);
        }
    }

    // 2. 加载 posts.json 并依次加载日志
    async function loadAllPosts() {
        try {
            // 从根目录加载 posts.json
            const response = await fetch('posts.json'); 
            if (!response.ok) {
                throw new Error('无法加载 posts.json 文件，请确保文件存在于根目录。');
            }
            
            const postList = await response.json();

            // 检查列表是否为空
            if (postList.length === 0) {
                postsContainer.innerHTML = '<p>暂无日志。</p>';
                return;
            }

            // 遍历 JSON 列表，依次加载并渲染每个日志
            postList.forEach(loadPost);

        } catch (error) {
            console.error('加载日志列表出错:', error);
            postsContainer.innerHTML = `<p style="color:red;">初始化失败：${error.message}</p>`;
        }
    }

    loadAllPosts();
});
</script>

</body>
</html>